<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetaMask Message Signing</title>
</head>

<body>
    <h1>MetaMask Message Signing Example</h1>

    <!-- Button to Connect MetaMask -->
    <button id="connectButton">Connect MetaMask</button>

    <!-- Button to Sign Message -->
    <button id="signButton" disabled>Sign Message</button>

    <!-- Display Signed Message -->
    <p id="signedMessage"></p>

    <!-- Display Account Address -->
    <p id="accountAddress"></p>

    <script>
        let account;

        // Check if MetaMask is installed
        window.addEventListener('load', function () {
            if (typeof window.ethereum !== 'undefined') {
                console.log('MetaMask is installed!');
            } else {
                alert('Please install MetaMask!');
            }
        });

        // Function to connect to MetaMask
        async function connectMetaMask() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    // Request account access if needed
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    account = accounts[0]; // Get the first account
                    document.getElementById('accountAddress').innerText = `Connected Account: ${account}`;
                    document.getElementById('signButton').disabled = false; // Enable the sign button
                } catch (error) {
                    console.error("User rejected the request", error);
                }
            } else {
                alert('MetaMask is not installed. Please install it to use this app!');
            }
        }

        // Function to sign a message
        async function signMessage() {
            const message = 'Hello, this is a test message!';
            try {
                const signature = await ethereum.request({
                    method: 'personal_sign',
                    params: [account, message]
                });
                document.getElementById('signedMessage').innerText = `Signed Message: ${signature}`;
            } catch (error) {
                console.error('Error signing message:', error);
            }
        }

        // Add event listeners to the buttons
        document.getElementById('connectButton').addEventListener('click', connectMetaMask);
        document.getElementById('signButton').addEventListener('click', signMessage);
    </script>
</body>

</html>
